<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Позвонить сыну</title>
  <style>
    html, body { margin:0; padding:0; height:100%;
      background:#0b1220; color:#fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    #app { height:100%; display:flex; align-items:stretch; justify-content:center; }
    #jitsi { width:100%; height:100%; }
    .fallback { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; padding:24px; text-align:center; }
    .hidden { display:none; }
    a { color:#7aa2ff; }
  </style>
</head>
<body>
  <div id="app">
    <div id="jitsi"></div>
    <div id="fallback" class="fallback hidden">
      <div>
        <h1>Подключаемся к звонку…</h1>
        <p>Если долго не открывается, нажмите: <a id="directLink" href="#">Открыть звонок напрямую</a></p>
      </div>
    </div>
  </div>

  <script>
    // Имя комнаты (можно оставить как есть)
    const ROOM = "SonCall-gvdSqYHlyE";
    const DOMAIN = "meet.jit.si";

    // Запасная прямая ссылка на комнату (без экранов приложения)
    const directUrl = "https://" + DOMAIN + "/" + encodeURIComponent(ROOM) +
      "#config.prejoinPageEnabled=false&config.disableDeepLinking=true";
    document.getElementById('directLink').href = directUrl;

    // Запускаем встроенное окно Jitsi без лишних экранов/регистрации
    function start() {
      if (!window.JitsiMeetExternalAPI) {
        document.getElementById('fallback').classList.remove('hidden');
        return;
      }
      const parent = document.getElementById('jitsi');
      const api = new JitsiMeetExternalAPI(DOMAIN, {
        roomName: ROOM,
        parentNode: parent,
        userInfo: { displayName: "Мама" },
        configOverwrite: {
          prejoinPageEnabled: false,
          startWithAudioMuted: false,
          startWithVideoMuted: false,
          disableDeepLinking: true
        },
        interfaceConfigOverwrite: {
          MOBILE_APP_PROMO: false,
          HIDE_INVITE_MORE_HEADER: true,
          DISABLE_JOIN_LEAVE_NOTIFICATIONS: true,
          TOOLBAR_ALWAYS_VISIBLE: true,
          // Оставляем только нужные кнопки
          TOOLBAR_BUTTONS: ["microphone","camera","hangup","tileview","fullscreen"]
        }
      });
    }

    // Подключаем API и стартуем
    (function load() {
      const s = document.createElement('script');
      s.src = "https://meet.jit.si/external_api.js";
      s.onload = start;
      s.onerror = () => document.getElementById('fallback').classList.remove('hidden');
      document.body.appendChild(s);
    })();
  </script>
</body>
</html>

